<html lang="es">
    <head>
        <link rel="stylesheet" href="index.css"/>

        <link rel="stylesheet" href="/plugins/gLightbox_3.2.0/css/glightbox.min.css" />
        <script src="/plugins/gLightbox_3.2.0/js/glightbox.min.js"></script>


    </head>
<body>

    <section id='grid--masonry' class="gallery"></section>


    <script>


        getImgs();

        async function getImgs(){
            let imgs = await fetch("images.json").then((response) => response.json());

            const gallery = document.querySelector(".gallery");

            console.log("IMGS", imgs);

            for (const url of imgs){
                let a = document.createElement('a');
                a.className="gallery-item";
                a.href=url;

                let div = document.createElement("div");
                div.className="content"

                let img = document.createElement("img")
                img.src=url;

                div.appendChild(img);
                a.appendChild(div);
                gallery.appendChild(a);
            }


            initMansonry();
            
        }
        

    </script>

    <script>

        var gallery = document.querySelector('#grid--masonry');
        var getVal = function (elem, style) { return parseInt(window.getComputedStyle(elem).getPropertyValue(style)); };
        var getHeight = function (item) { return item.querySelector('img').getBoundingClientRect().height; };
        var resizeAll = function () {

            var altura = getVal(gallery, 'grid-auto-rows');
            var gap = getVal(gallery, 'grid-row-gap');
            gallery.querySelectorAll('.gallery-item').forEach(function (item) {
                var el = item;
                el.style.gridRowEnd = "span " + Math.ceil((getHeight(item) + gap) / (altura + gap));
            });
        };
    

        function initMansonry(){


            gallery.querySelectorAll('img').forEach(function (item) {
                item.classList.add('byebye');
                if (item.complete) {
                    console.log(item.src);
                }
                else {
                    item.addEventListener('load', function () {
                        var altura = getVal(gallery, 'grid-auto-rows');
                        var gap = getVal(gallery, 'grid-row-gap');
                        var gitem = item.parentElement.parentElement;
                        gitem.style.gridRowEnd = "span " + Math.ceil((getHeight(gitem) + gap) / (altura + gap));
                        item.classList.remove('byebye');
                    });
                }
            });

            resizeAll();
            window.addEventListener('resize', resizeAll);

            var lightbox = GLightbox({
                selector: '.gallery-item'
            });
        }

        
    </script>

</body>
</html>