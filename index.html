<html lang="es">
    <head>
        <link rel="stylesheet" href="index.css"/>

        <link rel="stylesheet" href="plugins/gLightbox_3.2.0/css/glightbox.min.css" />
        <script src="plugins/gLightbox_3.2.0/js/glightbox.min.js"></script>



    </head>
<body>

    <section id="audio">
        <audio controls autoplay>
            <source src="audio/cancion.mp3" type="audio/mp3">
        </audio>
    </section>

    <section id='grid--masonry' class="gallery">
        <!-- <a class="gallery-item" href="img/Umaru meme.jpg"><div class="content"><img src="img/Umaru meme.jpg"></div></a> -->
    </section>


    <script>

    document.addEventListener("DOMContentLoaded", function(event) {
        
        getImgs();

        //código a ejecutar cuando existe la certeza de que el DOM está listo para recibir acciones
    });

    async function getImgs(){
            let imgs = await fetch("imagesId.json").then((response) => response.json());

            // Barajar imagenes (Cambiar el orden)
            imgs = imgs
                .map(value => ({ value, sort: Math.random() }))
                .sort((a, b) => a.sort - b.sort)
                .map(({ value }) => value)

            const gallery = document.querySelector(".gallery");

            console.log("IMGS", imgs);

            for (const id of imgs){
                let a = document.createElement('a');
                a.className="gallery-item";
                a.setAttribute("data-type","image");
                a.href="https://lh3.googleusercontent.com/d/"+id+"=s4000";

                let div = document.createElement("div");
                div.className="content"

                let img = document.createElement("img")
                img.src="https://lh3.googleusercontent.com/d/"+id+"=w350";

                div.appendChild(img);
                a.appendChild(div);
                gallery.appendChild(a);
            }


            initMansonry();
            
        }

        //https://lh3.googleusercontent.com/d/19tMIS9GsvsLS3bb_D__1sWXkZO68274R=s4000
        //https://lh3.googleusercontent.com/d/19tMIS9GsvsLS3bb_D__1sWXkZO68274R=s4000

    </script>

    <script>

        // Función para cargar la API de Google Drive
        function loadDriveApi() {
            console.log("init");

            // Inicializar la API client con tus credenciales y scopes necesarios
            gapi.client.init({
                apiKey: 'AIzaSyCApwQ2HZOFrm_wfLTc-cTKboWlt7q-3iE',
                clientId: '527521356951-t5ltk1n08os4r6jj92nbkel29c202pgs.apps.googleusercontent.com',
                discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
                scope: 'https://www.googleapis.com/auth/drive.readonly'
            }).then(function() {
                console.log('API de Google Drive inicializada correctamente');
            }).catch(function(error) {
                console.error('Error al inicializar API de Google Drive:', error);
            });

            gapi.client.load('drive', 'v3', listFiles);
        }

        // Función para listar los archivos en una carpeta específica
        function listFiles() {
            // ID de la carpeta de Google Drive
            var folderId = '1j9mtn98SkUMciS9rAFKv4aFFhBhKUtA1';

            // Solicitar lista de archivos
            gapi.client.drive.files.list({
                'q': "'" + folderId + "' in parents and trashed=false",
                'fields': 'files(name)'
            }).then(function(response) {
                var files = response.result.files;
                if (files && files.length > 0) {
                    // Iterar sobre los archivos y mostrar sus nombres
                    for (var i = 0; i < files.length; i++) {
                        console.log(files[i].name);
                    }
                } else {
                    console.log('No se encontraron archivos en la carpeta.');
                }
            });
        }

    </script>

    <script>

        var gallery = document.querySelector('#grid--masonry');
        var getVal = function (elem, style) { return parseInt(window.getComputedStyle(elem).getPropertyValue(style)); };
        var getHeight = function (item) { return item.querySelector('img').getBoundingClientRect().height; };
        var resizeAll = function () {

            var altura = getVal(gallery, 'grid-auto-rows');
            var gap = getVal(gallery, 'grid-row-gap');
            gallery.querySelectorAll('.gallery-item').forEach(function (item) {
                var el = item;
                el.style.gridRowEnd = "span " + Math.ceil((getHeight(item) + gap) / (altura + gap));
            });
        };
    

        function initMansonry(){


            gallery.querySelectorAll('img').forEach(function (item) {
                item.classList.add('byebye');
                if (item.complete) {
                    console.log(item.src);
                }
                else {
                    item.addEventListener('load', function () {
                        var altura = getVal(gallery, 'grid-auto-rows');
                        var gap = getVal(gallery, 'grid-row-gap');
                        var gitem = item.parentElement.parentElement;
                        gitem.style.gridRowEnd = "span " + Math.ceil((getHeight(gitem) + gap) / (altura + gap));
                        item.classList.remove('byebye');
                    });
                }
            });

            resizeAll();
            window.addEventListener('resize', resizeAll);

            var lightbox = GLightbox({
                selector: '.gallery-item'
            });
        }

        
    </script>

</body>
</html>